/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@vfx-js/core@0.8.0/lib/esm/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as e from"/npm/three@0.177.0/index.mjs";function t(e,t,n,r){return{x:e.left+n,y:t-2*r-e.bottom,w:e.right-e.left,h:e.bottom-e.top}}function n(e,t,n,r){return{x:e,y:t,w:n,h:r}}var r,o,i,s,a=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},f=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class c{constructor(t,n,f){r.set(this,void 0),o.set(this,void 0),i.set(this,void 0),s.set(this,void 0),a(this,r,t,"f"),a(this,o,n,"f"),a(this,i,f,"f");const c=t*f,l=n*f;a(this,s,[new e.WebGLRenderTarget(c,l),new e.WebGLRenderTarget(c,l)],"f")}get texture(){return f(this,s,"f")[0].texture}get target(){return f(this,s,"f")[1]}resize(e,t){e===f(this,r,"f")&&t===f(this,o,"f")||(a(this,r,e,"f"),a(this,o,t,"f"),f(this,s,"f")[0].setSize(e*f(this,i,"f"),t*f(this,i,"f")),f(this,s,"f")[1].setSize(e*f(this,i,"f"),t*f(this,i,"f")))}swap(){a(this,s,[f(this,s,"f")[1],f(this,s,"f")[0]],"f")}getViewport(){return n(0,0,f(this,r,"f"),f(this,o,"f"))}}r=new WeakMap,o=new WeakMap,i=new WeakMap,s=new WeakMap;const l="\nprecision highp float;\nin vec3 position;\nvoid main() {\n    gl_Position = vec4(position, 1.0);\n}\n",u="\nprecision highp float;\nattribute vec3 position;\nvoid main() {\n    gl_Position = vec4(position, 1.0);\n}\n",h="\nprecision highp float;\nuniform vec2 offset;\nuniform vec2 resolution;\nuniform sampler2D src;\nout vec4 outColor;\nvoid main() {\n    vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n    if (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) {\n        discard;\n    }\n    outColor = texture(src, uv);\n}\n",d="precision highp float;\nuniform vec2 resolution;\nuniform vec2 offset;\nuniform float time;\nuniform bool autoCrop;\nuniform sampler2D src;\nout vec4 outColor;\n",v="vec4 readTex(sampler2D tex, vec2 uv) {\n    if (autoCrop && (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.)) {\n        return vec4(0);\n    }\n    return texture(tex, uv);\n}",m={none:h,uvGradient:`\n    ${d}\n    ${v}\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        outColor = vec4(uv, sin(time) * .5 + .5, 1);\n\n        vec4 img = readTex(src, uv);\n        outColor *= smoothstep(0., 1., img.a);\n    }\n    `,rainbow:`\n    ${d}\n    ${v}\n\n    vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    vec3 hueShift(vec3 rgb, float t) {\n        vec3 hsv = rgb2hsv(rgb);\n        hsv.x = fract(hsv.x + t);\n        return hsv2rgb(hsv);\n    }\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec2 uv2 = uv;\n        uv2.x *= resolution.x / resolution.y;\n\n        float x = (uv2.x - uv2.y) - fract(time);\n\n        vec4 img = readTex(src, uv);\n        float gray = length(img.rgb);\n\n        img.rgb = vec3(hueShift(vec3(1,0,0), x) * gray);\n\n        outColor = img;\n    }\n    `,glitch:`\n    ${d}\n    ${v}\n\n    float nn(float y, float t) {\n        float n = (\n            sin(y * .07 + t * 8. + sin(y * .5 + t * 10.)) +\n            sin(y * .7 + t * 2. + sin(y * .3 + t * 8.)) * .7 +\n            sin(y * 1.1 + t * 2.8) * .4\n        );\n\n        n += sin(y * 124. + t * 100.7) * sin(y * 877. - t * 38.8) * .3;\n\n        return n;\n    }\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n\n        float t = mod(time, 3.14 * 10.);\n\n        // Seed value\n        float v = fract(sin(t * 2.) * 700.);\n\n        if (abs(nn(uv.y, t)) < 1.2) {\n            v *= 0.01;\n        }\n\n        // Prepare for chromatic Abbreveation\n        vec2 focus = vec2(0.5);\n        float d = v * 0.6;\n        vec2 ruv = focus + (uv - focus) * (1. - d);\n        vec2 guv = focus + (uv - focus) * (1. - 2. * d);\n        vec2 buv = focus + (uv - focus) * (1. - 3. * d);\n\n        // Random Glitch\n        if (v > 0.1) {\n            // Randomize y\n            float y = floor(uv.y * 13. * sin(35. * t)) + 1.;\n            if (sin(36. * y * v) > 0.9) {\n                ruv.x = uv.x + sin(76. * y) * 0.1;\n                guv.x = uv.x + sin(34. * y) * 0.1;\n                buv.x = uv.x + sin(59. * y) * 0.1;\n            }\n\n            // RGB Shift\n            v = pow(v * 1.5, 2.) * 0.15;\n            color.rgb *= 0.3;\n            color.r += readTex(src, vec2(uv.x + sin(t * 123.45) * v, uv.y)).r;\n            color.g += readTex(src, vec2(uv.x + sin(t * 157.67) * v, uv.y)).g;\n            color.b += readTex(src, vec2(uv.x + sin(t * 143.67) * v, uv.y)).b;\n        }\n\n        // Compose Chromatic Abbreveation\n        if (abs(nn(uv.y, t)) > 1.1) {\n            color.r = color.r * 0.5 + color.r * texture(src, ruv).r;\n            color.g = color.g * 0.5 + color.g * texture(src, guv).g;\n            color.b = color.b * 0.5 + color.b * texture(src, buv).b;\n            color *= 2.;\n        }\n\n        outColor = color;\n        outColor.a = smoothstep(0.0, 0.8, max(color.r, max(color.g, color.b)));\n    }\n    `,pixelate:`\n    ${d}\n    ${v}\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        float b = sin(time * 2.) * 32. + 48.;\n        uv = floor(uv * b) / b;\n        outColor = readTex(src, uv);\n    }\n    `,rgbGlitch:`\n    ${d}\n    ${v}\n\n    float random(vec2 st) {\n        return fract(sin(dot(st, vec2(948.,824.))) * 30284.);\n    }\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec2 uvr = uv, uvg = uv, uvb = uv;\n\n        float tt = mod(time, 17.);\n\n        if (fract(tt * 0.73) > .8 || fract(tt * 0.91) > .8) {\n            float t = floor(tt * 11.);\n\n            float n = random(vec2(t, floor(uv.y * 17.7)));\n            if (n > .7) {\n                uvr.x += random(vec2(t, 1.)) * .1 - 0.05;\n                uvg.x += random(vec2(t, 2.)) * .1 - 0.05;\n                uvb.x += random(vec2(t, 3.)) * .1 - 0.05;\n            }\n\n            float ny = random(vec2(t * 17. + floor(uv * 19.7)));\n            if (ny > .7) {\n                uvr.x += random(vec2(t, 4.)) * .1 - 0.05;\n                uvg.x += random(vec2(t, 5.)) * .1 - 0.05;\n                uvb.x += random(vec2(t, 6.)) * .1 - 0.05;\n            }\n        }\n\n        vec4 cr = readTex(src, uvr);\n        vec4 cg = readTex(src, uvg);\n        vec4 cb = readTex(src, uvb);\n\n        outColor = vec4(\n            cr.r,\n            cg.g,\n            cb.b,\n            step(.1, cr.a + cg.a + cb.a)\n        );\n    }\n    `,rgbShift:`\n    ${d}\n    ${v}\n\n    float nn(float y, float t) {\n        float n = (\n            sin(y * .07 + t * 8. + sin(y * .5 + t * 10.)) +\n            sin(y * .7 + t * 2. + sin(y * .3 + t * 8.)) * .7 +\n            sin(y * 1.1 + t * 2.8) * .4\n        );\n\n        n += sin(y * 124. + t * 100.7) * sin(y * 877. - t * 38.8) * .3;\n\n        return n;\n    }\n\n    float step2(float t, vec2 uv) {\n        return step(t, uv.x) * step(t, uv.y);\n    }\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec2 uvr = uv, uvg = uv, uvb = uv;\n\n        float t = mod(time, 30.);\n\n        float amp = 10. / resolution.x;\n\n        if (abs(nn(uv.y, t)) > 1.) {\n            uvr.x += nn(uv.y, t) * amp;\n            uvg.x += nn(uv.y, t + 10.) * amp;\n            uvb.x += nn(uv.y, t + 20.) * amp;\n        }\n\n        vec4 cr = readTex(src, uvr);\n        vec4 cg = readTex(src, uvg);\n        vec4 cb = readTex(src, uvb);\n\n        outColor = vec4(\n            cr.r,\n            cg.g,\n            cb.b,\n            smoothstep(.0, 1., cr.a + cg.a + cb.a)\n        );\n    }\n    `,halftone:`\n    // Halftone Effect by zoidberg\n    // https://www.interactiveshaderformat.com/sketches/234\n\n    ${d}\n    ${v}\n\n    // TODO: uniform\n    #define gridSize 10.0\n    #define dotSize 0.7\n    #define smoothing 0.15\n    #define speed 1.0\n\n    #define IMG_PIXEL(x, y) readTex(x, (y - offset) / resolution);\n\n    vec4 gridRot = vec4(15.0, 45.0, 75.0, 0.0);\n\n    // during calculation we find the closest dot to a frag, determine its size, and then determine the size of the four dots above/below/right/left of it. this array of offsets move "one left", "one up", "one right", and "one down"...\n    vec2 originOffsets[4];\n\n    void main() {\n        vec2 fragCoord = gl_FragCoord.xy - offset;\n\n        // a halftone is an overlapping series of grids of dots\n        // each grid of dots is rotated by a different amount\n        // the size of the dots determines the colors. the shape of the dot should never change (always be a dot with regular edges)\n        originOffsets[0] = vec2(-1.0, 0.0);\n        originOffsets[1] = vec2(0.0, 1.0);\n        originOffsets[2] = vec2(1.0, 0.0);\n        originOffsets[3] = vec2(0.0, -1.0);\n\n        vec3 rgbAmounts = vec3(0.0);\n\n        // for each of the channels (i) of RGB...\n        for (float i=0.0; i<3.0; ++i) {\n            // figure out the rotation of the grid in radians\n            float rotRad = radians(gridRot[int(i)]);\n\n            // the grids are rotated counter-clockwise- to find the nearest dot, take the fragment pixel loc,\n            // rotate it clockwise, and split by the grid to find the center of the dot. then rotate this\n            // coord counter-clockwise to yield the location of the center of the dot in pixel coords local to the render space\n            mat2 ccTrans = mat2(vec2(cos(rotRad), sin(rotRad)), vec2(-1.0*sin(rotRad), cos(rotRad)));\n            mat2 cTrans = mat2(vec2(cos(rotRad), -1.0*sin(rotRad)), vec2(sin(rotRad), cos(rotRad)));\n\n            // find the location of the frag in the grid (prior to rotating it)\n            vec2 gridFragLoc = cTrans * fragCoord.xy;\n\n            // find the center of the dot closest to the frag- there's no "round" in GLSL 1.2, so do a "floor" to find the dot to the bottom-left of the frag, then figure out if the frag would be in the top and right halves of that square to find the closest dot to the frag\n            vec2 gridOriginLoc = vec2(floor(gridFragLoc.x/gridSize), floor(gridFragLoc.y/gridSize));\n\n            vec2 tmpGridCoords = gridFragLoc/vec2(gridSize);\n            bool fragAtTopOfGrid = ((tmpGridCoords.y-floor(tmpGridCoords.y)) > (gridSize/2.0)) ? true : false;\n            bool fragAtRightOfGrid = ((tmpGridCoords.x-floor(tmpGridCoords.x)) > (gridSize/2.0)) ? true : false;\n            if (fragAtTopOfGrid)\n                gridOriginLoc.y = gridOriginLoc.y + 1.0;\n            if (fragAtRightOfGrid)\n                gridOriginLoc.x = gridOriginLoc.x + 1.0;\n\n            // ...at this point, "gridOriginLoc" contains the grid coords of the nearest dot to the fragment being rendered\n            // convert the location of the center of the dot from grid coords to pixel coords\n            vec2 gridDotLoc = vec2(gridOriginLoc.x*gridSize, gridOriginLoc.y*gridSize) + vec2(gridSize/2.0);\n\n            // rotate the pixel coords of the center of the dot so they become relative to the rendering space\n            vec2 renderDotLoc = ccTrans * gridDotLoc;\n\n            // get the color of the pixel of the input image under this dot (the color will ultimately determine the size of the dot)\n            vec4 renderDotImageColorRGB = IMG_PIXEL(src, renderDotLoc + offset);\n\n            // the amount of this channel is taken from the same channel of the color of the pixel of the input image under this halftone dot\n            float imageChannelAmount = renderDotImageColorRGB[int(i)];\n\n            // the size of the dot is determined by the value of the channel\n            float dotRadius = imageChannelAmount * (gridSize * dotSize);\n            float fragDistanceToDotCenter = distance(fragCoord.xy, renderDotLoc);\n            if (fragDistanceToDotCenter < dotRadius) {\n                rgbAmounts[int(i)] += smoothstep(dotRadius, dotRadius-(dotRadius*smoothing), fragDistanceToDotCenter);\n            }\n\n            // calcluate the size of the dots abov/below/to the left/right to see if they're overlapping\n            for (float j=0.0; j<4.0; ++j) {\n                gridDotLoc = vec2((gridOriginLoc.x+originOffsets[int(j)].x)*gridSize, (gridOriginLoc.y+originOffsets[int(j)].y)*gridSize) + vec2(gridSize/2.0);\n\n                renderDotLoc = ccTrans * gridDotLoc;\n                renderDotImageColorRGB = IMG_PIXEL(src, renderDotLoc + offset);\n\n                imageChannelAmount = renderDotImageColorRGB[int(i)];\n                dotRadius = imageChannelAmount * (gridSize*1.50/2.0);\n                fragDistanceToDotCenter = distance(fragCoord.xy, renderDotLoc);\n                if (fragDistanceToDotCenter < dotRadius) {\n                    rgbAmounts[int(i)] += smoothstep(dotRadius, dotRadius-(dotRadius*smoothing), fragDistanceToDotCenter);\n                }\n            }\n        }\n\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 original = readTex(src, uv);\n        float alpha = step(.1, rgbAmounts[0] + rgbAmounts[1] + rgbAmounts[2] + original.a);\n\n        outColor = vec4(rgbAmounts[0], rgbAmounts[1], rgbAmounts[2], alpha);\n    }\n    `,sinewave:`\n    ${d}\n    ${v}\n\n    vec4 draw(vec2 uv) {\n        vec2 uvr = uv, uvg = uv, uvb = uv;\n\n        float amp = 20. / resolution.x;\n\n        uvr.x += sin(uv.y * 7. + time * 3.) * amp;\n        uvg.x += sin(uv.y * 7. + time * 3. + .4) * amp;\n        uvb.x += sin(uv.y * 7. + time * 3. + .8) * amp;\n\n        vec4 cr = readTex(src, uvr);\n        vec4 cg = readTex(src, uvg);\n        vec4 cb = readTex(src, uvb);\n\n        return vec4(\n            cr.r,\n            cg.g,\n            cb.b,\n            cr.a + cg.a + cb.a\n        );\n    }\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        // x blur\n        vec2 dx = vec2(2, 0) / resolution.x;\n        outColor = (draw(uv) * 2. + draw(uv + dx) + draw(uv - dx)) / 4.;\n    }\n    `,shine:`\n    ${d}\n    ${v}\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        vec2 p = uv * 2. - 1.;\n        float a = atan(p.y, p.x);\n\n        vec4 col = readTex(src, uv);\n        float gray = length(col.rgb);\n\n        float level = 1. + sin(a * 10. + time * 3.) * 0.2;\n\n        outColor = vec4(1, 1, .5, col.a) * level;\n    }\n    `,blink:`\n    ${d}\n    ${v}\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        outColor = readTex(src, uv) * (sin(time * 5.) * 0.2 + 0.8);\n    }\n\n    `,spring:`\n    ${d}\n    ${v}\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        uv = (uv - .5) * (1.05 + sin(time * 5.) * 0.05) + .5;\n        outColor = readTex(src, uv);\n    }\n    `,duotone:`\n    ${d}\n    ${v}\n\n    uniform vec4 color1;\n    uniform vec4 color2;\n    uniform float speed;\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n\n        float gray = dot(color.rgb, vec3(0.2, 0.7, 0.08));\n        float t = mod(gray * 2.0 + time * speed, 2.0);\n\n        if (t < 1.) {\n            outColor = mix(color1, color2, fract(t));\n        } else {\n            outColor = mix(color2, color1, fract(t));\n        }\n\n        outColor.a *= color.a;\n    }\n    `,tritone:`\n    ${d}\n    ${v}\n\n    uniform vec4 color1;\n    uniform vec4 color2;\n    uniform vec4 color3;\n    uniform float speed;\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n\n        float gray = dot(color.rgb, vec3(0.2, 0.7, 0.08));\n        float t = mod(gray * 3.0 + time * speed, 3.0);\n\n        if (t < 1.) {\n            outColor = mix(color1, color2, fract(t));\n        } else if (t < 2.) {\n            outColor = mix(color2, color3, fract(t));\n        } else {\n            outColor = mix(color3, color1, fract(t));\n        }\n\n        outColor.a *= color.a;\n    }\n    `,hueShift:`\n    ${d}\n    ${v}\n\n    uniform float shift;\n\n    vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    vec3 hueShift(vec3 rgb, float t) {\n        vec3 hsv = rgb2hsv(rgb);\n        hsv.x = fract(hsv.x + t);\n        return hsv2rgb(hsv);\n    }\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n        color.rgb = hueShift(color.rgb, shift);\n        outColor = color;\n    }\n    `,warpTransition:`\n    ${d}\n    uniform float enterTime;\n    uniform float leaveTime;\n\n    ${v}\n\n    #define DURATION 1.0\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        float t1 = enterTime / DURATION;\n        float t2 = leaveTime / DURATION;\n        float t = clamp(min(t1, 1. - t2), 0., 1.);\n\n        if (t == 0.) {\n            discard;\n        }\n\n        if (t < 1.) {\n            uv.x += sin(floor(uv.y * 300.)) * 3. * exp(t * -10.);\n        }\n\n        outColor = readTex(src, uv);\n    }\n    `,slitScanTransition:`\n    ${d}\n    ${v}\n\n    uniform float enterTime;\n    uniform float leaveTime;\n\n    #define DURATION 1.0\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        float t1 = enterTime / DURATION;\n        float t2 = leaveTime / DURATION;\n\n        // Do not render before enter or after leave\n        if (t1 < 0. || 1. < t2) {\n            discard;\n        }\n\n        if (0. < t2) {\n            // Leaving\n            float t = 1. - t2;\n            uv.y = uv.y < t ? uv.y : t;\n        } else if (t1 < 1.) {\n            // Entering\n            float t = 1. - t1;\n            uv.y = uv.y < t ? t : uv.y;\n        }\n\n        outColor = readTex(src, uv);\n    }\n    `,pixelateTransition:`\n    ${d}\n    ${v}\n\n    uniform float enterTime;\n    uniform float leaveTime;\n\n    #define DURATION 1.0\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        float t1 = enterTime / DURATION;\n        float t2 = leaveTime / DURATION;\n        float t = clamp(min(t1, 1. - t2), 0., 1.);\n\n        if (t == 0.) {\n            discard;\n        } else if (t < 1.) {\n            float b = floor(t * 64.);\n            uv = (floor(uv * b) + .5) / b;\n        }\n\n        outColor = readTex(src, uv);\n    }\n    `,focusTransition:`\n    ${d}\n    ${v}\n\n    uniform float intersection;\n\n    void main (void) {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        float t = smoothstep(0., 1., intersection);\n\n        outColor = mix(\n            readTex(src, uv + vec2(1. - t, 0)),\n            readTex(src, uv + vec2(-(1. - t), 0)),\n            0.5\n        ) * intersection;\n    }\n    `,invert:`\n    ${d}\n    ${v}\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n        outColor = vec4(1.0 - color.rgb, color.a);\n    }\n    `,grayscale:`\n    ${d}\n    ${v}\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        vec4 color = readTex(src, uv);\n        float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n        outColor = vec4(vec3(gray), color.a);\n    }\n    `,vignette:`\n    ${d}\n    ${v}\n\n    uniform float intensity;\n    uniform float radius;\n    uniform float power;\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n        outColor = readTex(src, uv);\n\n        vec2 p = uv * 2.0 - 1.0;\n        p.x *= resolution.x / resolution.y;\n\n        float l = max(length(p) - radius, 0.);\n        outColor *= 1. - pow(l, power) * intensity;\n    }\n    `,chromatic:`\n    ${d}\n    ${v}\n\n    uniform float intensity;\n    uniform float radius;\n    uniform float power;\n\n\n    vec4 mirrorTex(sampler2D tex, vec2 uv) {\n        vec2 uv2 = 1. - abs(1. - mod(uv, 2.0));\n        return texture(tex, uv2);\n    }\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - offset) / resolution;\n\n        vec2 p = uv * 2.0 - 1.0;\n        p.x *= resolution.x / resolution.y;\n\n        float l = max(length(p) - radius, 0.);\n        float d = pow(l, power) * (intensity * 0.1);\n\n        vec2 uvR = (uv - .5) / (1.0 + d * 1.) + 0.5;\n        vec2 uvG = (uv - .5) / (1.0 + d * 2.) + 0.5;\n        vec2 uvB = (uv - .5) / (1.0 + d * 3.) + 0.5;\n\n        vec4 cr = mirrorTex(src, uvR);\n        vec4 cg = mirrorTex(src, uvG);\n        vec4 cb = mirrorTex(src, uvB);\n\n        outColor = vec4(cr.r, cg.g, cb.b, (cr.a + cg.a + cb.a) / 3.0);\n    }\n    `};var p,g,w,y=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},b=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class x{constructor(){p.set(this,void 0),g.set(this,void 0),w.set(this,void 0),y(this,p,new e.Scene,"f"),y(this,w,{src:{value:null},offset:{value:new e.Vector2},resolution:{value:new e.Vector2},viewport:{value:new e.Vector4}},"f"),y(this,g,new e.Mesh(new e.PlaneGeometry(2,2),new e.RawShaderMaterial({vertexShader:l,fragmentShader:h,uniforms:b(this,w,"f"),glslVersion:"300 es",transparent:!0,premultipliedAlpha:!0})),"f"),b(this,p,"f").add(b(this,g,"f"))}get uniforms(){return b(this,w,"f")}setUniforms(e,t,n){b(this,w,"f").src.value=e,b(this,w,"f").resolution.value.x=n.w*t,b(this,w,"f").resolution.value.y=n.h*t,b(this,w,"f").offset.value.x=n.x*t,b(this,w,"f").offset.value.y=n.y*t}get scene(){return b(this,p,"f")}}p=new WeakMap,g=new WeakMap,w=new WeakMap;var T=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{f(r.next(e))}catch(e){i(e)}}function a(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}f((r=r.apply(e,t||[])).next())}))};function C(e,t,n){return T(this,void 0,void 0,(function*(){const r=e.getBoundingClientRect(),o=window.devicePixelRatio,i=r.width*o,s=r.height*o,a=n&&n.width===i&&n.height===s?n:new OffscreenCanvas(i,s),f=e.cloneNode(!0);yield k(e,f),f.style.setProperty("opacity",t.toString()),f.style.setProperty("margin","0px");const c=(e=>{const t=document.implementation.createHTMLDocument("test"),n=t.createRange();n.selectNodeContents(t.documentElement),n.deleteContents();const r=document.createElement("head");return t.documentElement.appendChild(r),t.documentElement.appendChild(n.createContextualFragment(e)),t.documentElement.setAttribute("xmlns",t.documentElement.namespaceURI),(new XMLSerializer).serializeToString(t).replace(/<!DOCTYPE html>/,"")})(f.outerHTML),l=`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${s}"><foreignObject width="100%" height="100%">${c}</foreignObject></svg>`;return new Promise(((e,t)=>{const n=new Image;n.onload=()=>{const r=a.getContext("2d");if(null===r)return t();r.clearRect(0,0,i,s),r.scale(o,o),r.drawImage(n,0,0,i,s),r.setTransform(1,0,0,1,0,0),e(a)},n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`}))}))}function k(e,t){return T(this,void 0,void 0,(function*(){const n=window.getComputedStyle(e);for(const e of Array.from(n))t.style.setProperty(e,n.getPropertyValue(e),n.getPropertyPriority(e));"INPUT"===t.tagName?t.setAttribute("value",t.value):"TEXTAREA"===t.tagName?t.innerHTML=t.value:"IMG"===t.tagName&&(t.src=yield function(e){return T(this,void 0,void 0,(function*(){const t=yield fetch(e).then((e=>e.blob()));return new Promise((e=>{const n=new FileReader;n.onload=function(){e(this.result)},n.readAsDataURL(t)}))}))}(e.src));for(let n=0;n<e.children.length;n++){const r=e.children[n],o=t.children[n];yield k(r,o)}}))}function E(e){this.data=e,this.pos=0}function S(e){this.stream=new E(e),this.output={}}E.prototype.readByte=function(){return this.data[this.pos++]},E.prototype.peekByte=function(){return this.data[this.pos]},E.prototype.readBytes=function(e){return this.data.subarray(this.pos,this.pos+=e)},E.prototype.peekBytes=function(e){return this.data.subarray(this.pos,this.pos+e)},E.prototype.readString=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},E.prototype.readBitArray=function(){for(var e=[],t=this.readByte(),n=7;n>=0;n--)e.push(!!(t&1<<n));return e},E.prototype.readUnsigned=function(e){var t=this.readBytes(2);return e?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]},S.prototype.parse=function(e){return this.parseParts(this.output,e),this.output},S.prototype.parseParts=function(e,t){for(var n=0;n<t.length;n++){var r=t[n];this.parsePart(e,r)}},S.prototype.parsePart=function(e,t){var n,r=t.label;if(!t.requires||t.requires(this.stream,this.output,e))if(t.loop){for(var o=[];t.loop(this.stream);){var i={};this.parseParts(i,t.parts),o.push(i)}e[r]=o}else t.parts?(n={},this.parseParts(n,t.parts),e[r]=n):t.parser?(n=t.parser(this.stream,this.output,e),t.skip||(e[r]=n)):t.bits&&(e[r]=this.parseBits(t.bits))},S.prototype.parseBits=function(e){var t={},n=this.stream.readBitArray();for(var r in e){var o=e[r];o.length?t[r]=n.slice(o.index,o.index+o.length).reduce((function(e,t){return 2*e+t}),0):t[r]=n[o.index]}return t};var R=function(){return function(e){return e.readByte()}},M=function(e){return function(t){return t.readBytes(e)}},P=function(e){return function(t){return t.readString(e)}},z=function(e){return function(t){return t.readUnsigned(e)}},I=function(e,t){return function(n,r,o){for(var i=t(n,r,o),s=new Array(i),a=0;a<i;a++)s[a]=n.readBytes(e);return s}},L={label:"blocks",parser:function(e){for(var t=[],n=0,r=e.readByte();0!==r;r=e.readByte())t.push(e.readBytes(r)),n+=r;var o=new Uint8Array(n);n=0;for(var i=0;i<t.length;i++)o.set(t[i],n),n+=t[i].length;return o}},A={label:"gce",requires:function(e){var t=e.peekBytes(2);return 33===t[0]&&249===t[1]},parts:[{label:"codes",parser:M(2),skip:!0},{label:"byteSize",parser:R()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:z(!0)},{label:"transparentColorIndex",parser:R()},{label:"terminator",parser:R(),skip:!0}]},F={label:"image",requires:function(e){return 44===e.peekByte()},parts:[{label:"code",parser:R(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:z(!0)},{label:"top",parser:z(!0)},{label:"width",parser:z(!0)},{label:"height",parser:z(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(e,t,n){return n.descriptor.lct.exists},parser:I(3,(function(e,t,n){return Math.pow(2,n.descriptor.lct.size+1)}))},{label:"data",parts:[{label:"minCodeSize",parser:R()},L]}]},W={label:"text",requires:function(e){var t=e.peekBytes(2);return 33===t[0]&&1===t[1]},parts:[{label:"codes",parser:M(2),skip:!0},{label:"blockSize",parser:R()},{label:"preData",parser:function(e,t,n){return e.readBytes(n.text.blockSize)}},L]},D={label:"frames",parts:[A,{label:"application",requires:function(e,t,n){var r=e.peekBytes(2);return 33===r[0]&&255===r[1]},parts:[{label:"codes",parser:M(2),skip:!0},{label:"blockSize",parser:R()},{label:"id",parser:function(e,t,n){return e.readString(n.blockSize)}},L]},{label:"comment",requires:function(e,t,n){var r=e.peekBytes(2);return 33===r[0]&&254===r[1]},parts:[{label:"codes",parser:M(2),skip:!0},L]},F,W],loop:function(e){var t=e.peekByte();return 33===t||44===t}},O=[{label:"header",parts:[{label:"signature",parser:P(3)},{label:"version",parser:P(3)}]},{label:"lsd",parts:[{label:"width",parser:z(!0)},{label:"height",parser:z(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:R()},{label:"pixelAspectRatio",parser:R()}]},{label:"gct",requires:function(e,t){return t.lsd.gct.exists},parser:I(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},D];function $(e){var t=new S(new Uint8Array(e));this.raw=t.parse(O),this.raw.hasImages=!1;for(var n=0;n<this.raw.frames.length;n++)if(this.raw.frames[n].image){this.raw.hasImages=!0;break}}$.prototype.decompressFrame=function(e,t){if(e>=this.raw.frames.length)return null;var n=this.raw.frames[e];if(n.image){var r=n.image.descriptor.width*n.image.descriptor.height,o=function(e,t,n){var r,o,i,s,a,f,c,l,u,h,d,v,m,p,g,w,y=4096,b=-1,x=n,T=new Array(n),C=new Array(y),k=new Array(y),E=new Array(y+1);for(a=(o=1<<(v=e))+1,r=o+2,c=b,i=(1<<(s=v+1))-1,u=0;u<o;u++)C[u]=0,k[u]=u;for(d=l=m=p=w=g=0,h=0;h<x;){if(0===p){if(l<s){d+=t[g]<<l,l+=8,g++;continue}if(u=d&i,d>>=s,l-=s,u>r||u==a)break;if(u==o){i=(1<<(s=v+1))-1,r=o+2,c=b;continue}if(c==b){E[p++]=k[u],c=u,m=u;continue}for(f=u,u==r&&(E[p++]=m,u=c);u>o;)E[p++]=k[u],u=C[u];m=255&k[u],E[p++]=m,r<y&&(C[r]=c,k[r]=m,!(++r&i)&&r<y&&(s++,i+=r)),c=f}p--,T[w++]=E[p],h++}for(h=w;h<x;h++)T[h]=0;return T}(n.image.data.minCodeSize,n.image.data.blocks,r);n.image.descriptor.lct.interlaced&&(o=function(e,t){for(var n=new Array(e.length),r=e.length/t,o=function(r,o){var i=e.slice(o*t,(o+1)*t);n.splice.apply(n,[r*t,t].concat(i))},i=[0,4,2,1],s=[8,8,4,2],a=0,f=0;f<4;f++)for(var c=i[f];c<r;c+=s[f])o(c,a),a++;return n}(o,n.image.descriptor.width));var i={pixels:o,dims:{top:n.image.descriptor.top,left:n.image.descriptor.left,width:n.image.descriptor.width,height:n.image.descriptor.height}};return n.image.descriptor.lct&&n.image.descriptor.lct.exists?i.colorTable=n.image.lct:i.colorTable=this.raw.gct,n.gce&&(i.delay=10*(n.gce.delay||10),i.disposalType=n.gce.extras.disposal,n.gce.extras.transparentColorGiven&&(i.transparentIndex=n.gce.transparentColorIndex)),t&&(i.patch=function(e){for(var t=e.pixels.length,n=new Uint8ClampedArray(4*t),r=0;r<t;r++){var o=4*r,i=e.pixels[r],s=e.colorTable[i];n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2],n[o+3]=i!==e.transparentIndex?255:0}return n}(i)),i}return null},$.prototype.decompressFrames=function(e,t,n){void 0===t&&(t=0),n=void 0===n?this.raw.frames.length:Math.min(n,this.raw.frames.length);for(var r=[],o=t;o<n;o++){this.raw.frames[o].image&&r.push(this.decompressFrame(o,e))}return r};var B=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{f(r.next(e))}catch(e){i(e)}}function a(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}f((r=r.apply(e,t||[])).next())}))};class G{static create(e,t){return B(this,void 0,void 0,(function*(){const n=yield fetch(e).then((e=>e.arrayBuffer())).then((e=>new $(e))),r=n.decompressFrames(!0,void 0,void 0),{width:o,height:i}=n.raw.lsd;return new G(r,o,i,t)}))}constructor(e,t,n,r){this.frames=[],this.index=0,this.playTime=0,this.frames=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.pixelRatio=r,this.canvas.width=t,this.canvas.height=n,this.startTime=Date.now()}getCanvas(){return this.canvas}update(){const e=Date.now()-this.startTime;for(;this.playTime<e;){const e=this.frames[this.index%this.frames.length];this.playTime+=e.delay,this.index++}const t=this.frames[this.index%this.frames.length],n=new ImageData(t.patch,t.dims.width,t.dims.height);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.putImageData(n,t.dims.left,t.dims.top)}}var V,_,q,U,N,j=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},H=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class K{constructor(t,n,r){if(V.set(this,void 0),_.set(this,void 0),q.set(this,void 0),U.set(this,void 0),N.set(this,void 0),j(this,V,new e.Scene,"f"),j(this,U,{},"f"),j(this,q,{src:{value:null},offset:{value:new e.Vector2},resolution:{value:new e.Vector2},viewport:{value:new e.Vector4},time:{value:0},mouse:{value:new e.Vector2}},"f"),r&&(H(this,q,"f").backbuffer={value:null}),n)for(const[e,t]of Object.entries(n))"function"==typeof t?(H(this,U,"f")[e]=t,H(this,q,"f")[e]={value:t()}):H(this,q,"f")[e]={value:t};j(this,_,new e.Mesh(new e.PlaneGeometry(2,2),new e.RawShaderMaterial({vertexShader:l,fragmentShader:t,uniforms:H(this,q,"f"),glslVersion:"300 es",transparent:!0,premultipliedAlpha:!0})),"f"),H(this,V,"f").add(H(this,_,"f"))}get uniforms(){return H(this,q,"f")}setUniforms(e,t,n,r,o,i){H(this,q,"f").src.value=e,H(this,q,"f").resolution.value.x=n.w*t,H(this,q,"f").resolution.value.y=n.h*t,H(this,q,"f").offset.value.x=n.x*t,H(this,q,"f").offset.value.y=n.y*t,H(this,q,"f").time.value=r,H(this,q,"f").mouse.value.x=o*t,H(this,q,"f").mouse.value.y=i*t}updateCustomUniforms(e){for(const[e,t]of Object.entries(H(this,U,"f")))H(this,q,"f")[e]&&(H(this,q,"f")[e].value=t());if(e)for(const[t,n]of Object.entries(e))H(this,q,"f")[t]&&(H(this,q,"f")[t].value=n())}initializeBackbuffer(e,t,n){H(this,q,"f").backbuffer&&!H(this,N,"f")&&(j(this,N,new c(e,t,n),"f"),H(this,q,"f").backbuffer.value=H(this,N,"f").texture)}resizeBackbuffer(e,t){H(this,N,"f")&&H(this,N,"f").resize(e,t)}get backbuffer(){return H(this,N,"f")}get scene(){return H(this,V,"f")}}function X(e){var t,n,r,o;return"number"==typeof e?{top:e,right:e,bottom:e,left:e}:Array.isArray(e)?{top:e[0],right:e[1],bottom:e[2],left:e[3]}:{top:null!==(t=e.top)&&void 0!==t?t:0,right:null!==(n=e.right)&&void 0!==n?n:0,bottom:null!==(r=e.bottom)&&void 0!==r?r:0,left:null!==(o=e.left)&&void 0!==o?o:0}}function Y(e){return X(e)}V=new WeakMap,_=new WeakMap,q=new WeakMap,U=new WeakMap,N=new WeakMap;const J={top:0,right:0,bottom:0,left:0};function Q(e){return X(e)}function Z(e){return{top:e.top,right:e.right,bottom:e.bottom,left:e.left}}function ee(e,t){return{top:e.top-t.top,right:e.right+t.right,bottom:e.bottom+t.bottom,left:e.left-t.left}}function te(e,t,n){return Math.min(Math.max(e,t),n)}var ne,re,oe,ie,se,ae,fe,ce,le,ue,he,de,ve,me,pe,ge,we,ye,be,xe,Te,Ce,ke,Ee,Se,Re,Me,Pe,ze,Ie,Le,Ae,Fe,We,De,Oe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{f(r.next(e))}catch(e){i(e)}}function a(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}f((r=r.apply(e,t||[])).next())}))},$e=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},Be=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Ge=new Map;class Ve{constructor(t,n){if(ne.add(this),re.set(this,void 0),oe.set(this,void 0),ie.set(this,void 0),se.set(this,void 0),ae.set(this,void 0),fe.set(this,void 0),ce.set(this,void 0),le.set(this,{}),ue.set(this,void 0),he.set(this,2),de.set(this,[]),ve.set(this,Date.now()/1e3),me.set(this,new e.TextureLoader),pe.set(this,Q(0)),ge.set(this,Q(0)),we.set(this,[0,0]),ye.set(this,0),be.set(this,0),xe.set(this,0),Te.set(this,0),Ce.set(this,new WeakMap),ke.set(this,void 0),Re.set(this,(()=>Oe(this,void 0,void 0,(function*(){if("undefined"!=typeof window){for(const e of Be(this,de,"f"))if("text"===e.type&&e.isInViewport){const t=e.element.getBoundingClientRect();t.width===e.width&&t.height===e.height||(yield Be(this,ne,"m",Pe).call(this,e),e.width=t.width,e.height=t.height)}for(const e of Be(this,de,"f"))if("text"===e.type&&!e.isInViewport){const t=e.element.getBoundingClientRect();t.width===e.width&&t.height===e.height||(yield Be(this,ne,"m",Pe).call(this,e),e.width=t.width,e.height=t.height)}}})))),Me.set(this,(e=>{"undefined"!=typeof window&&($e(this,xe,e.clientX,"f"),$e(this,Te,window.innerHeight-e.clientY,"f"))})),ze.set(this,(()=>{this.isPlaying()&&(this.render(),$e(this,ue,requestAnimationFrame(Be(this,ze,"f")),"f"))})),$e(this,re,t,"f"),$e(this,oe,n,"f"),$e(this,ie,new e.WebGLRenderer({canvas:n,alpha:!0}),"f"),Be(this,ie,"f").autoClear=!1,Be(this,ie,"f").setClearAlpha(0),$e(this,he,t.pixelRatio,"f"),"undefined"!=typeof window&&(window.addEventListener("resize",Be(this,Re,"f")),window.addEventListener("mousemove",Be(this,Me,"f"))),Be(this,Re,"f").call(this),$e(this,se,new e.OrthographicCamera(-1,1,1,-1,.1,10),"f"),Be(this,se,"f").position.set(0,0,1),$e(this,ae,new x,"f"),t.postEffect){const e=Be(this,ne,"m",Le).call(this,t.postEffect.shader);if($e(this,fe,new K(e,t.postEffect.uniforms,t.postEffect.backbuffer),"f"),t.postEffect.uniforms)for(const[e,n]of Object.entries(t.postEffect.uniforms))"function"==typeof n&&(Be(this,le,"f")[e]=n)}}destroy(){this.stop(),"undefined"!=typeof window&&(window.removeEventListener("resize",Be(this,Re,"f")),window.removeEventListener("mousemove",Be(this,Me,"f"))),Be(this,ce,"f")&&Be(this,ce,"f").dispose()}addElement(t){return Oe(this,arguments,void 0,(function*(t,n={}){var r,o,i;const s=Be(this,ne,"m",Le).call(this,n.shader||"uvGradient"),a=Be(this,ne,"m",Ae).call(this,n.glslVersion,s),f=t.getBoundingClientRect(),h=Z(f),[d,v]=function(e){if(!0===e)return[!0,J];if(void 0===e)return[!1,J];return[!1,Y(e)]}(n.overflow),m=ee(h,v),p=function(e){var t,n;const r=null!==(t=null==e?void 0:e.threshold)&&void 0!==t?t:0,o=Y(null!==(n=null==e?void 0:e.rootMargin)&&void 0!==n?n:0);return{threshold:r,rootMargin:o}}(n.intersection),g=""===t.style.opacity?1:Number.parseFloat(t.style.opacity);let w,y,b=!1;if(t instanceof HTMLImageElement)if(y="img",b=!!t.src.match(/\.gif/i),b){const n=yield G.create(t.src,Be(this,he,"f"));Ge.set(t,n),w=new e.Texture(n.getCanvas())}else w=yield Be(this,me,"f").loadAsync(t.src);else if(t instanceof HTMLVideoElement)w=new e.VideoTexture(t),y="video";else if(t instanceof HTMLCanvasElement)w=new e.CanvasTexture(t),y="canvas";else{const n=yield C(t,g);w=new e.CanvasTexture(n),y="text"}const[x,T]=function(t){if(!t)return[e.ClampToEdgeWrapping,e.ClampToEdgeWrapping];if(Array.isArray(t))return[qe(t[0]),qe(t[1])];{const e=qe(t);return[e,e]}}(n.wrap);w.wrapS=x,w.wrapT=T,w.minFilter=e.LinearFilter,w.magFilter=e.LinearFilter,w.format=e.RGBAFormat,w.needsUpdate=!0;const k=null===(r=n.autoCrop)||void 0===r||r;if(!0===n.overlay);else if("number"==typeof n.overlay)t.style.setProperty("opacity",n.overlay.toString());else{const e="video"===y?"0.0001":"0";t.style.setProperty("opacity",e.toString())}const E={src:{value:w},resolution:{value:new e.Vector2},offset:{value:new e.Vector2},time:{value:0},enterTime:{value:-1},leaveTime:{value:-1},mouse:{value:new e.Vector2},intersection:{value:0},viewport:{value:new e.Vector4},autoCrop:{value:k}},S={};if(void 0!==n.uniforms){const e=Object.keys(n.uniforms);for(const t of e){const e=n.uniforms[t];"function"==typeof e?(E[t]={value:e()},S[t]=e):E[t]={value:e}}}let R;n.backbuffer&&(R=(()=>{const e=(m.right-m.left)*Be(this,he,"f"),t=(m.bottom-m.top)*Be(this,he,"f");return new c(e,t,Be(this,he,"f"))})(),E.backbuffer={value:R.texture});const M=new e.Scene,P=new e.PlaneGeometry(2,2),z="100"===a?u:l,I=new e.RawShaderMaterial({vertexShader:z,fragmentShader:s,transparent:!0,uniforms:E,glslVersion:a}),L=new e.Mesh(P,I);M.add(L);const A=Date.now()/1e3,F={type:y,element:t,isInViewport:!1,isInLogicalViewport:!1,width:f.width,height:f.height,scene:M,mesh:L,uniforms:E,uniformGenerators:S,startTime:A,enterTime:A,leaveTime:Number.NEGATIVE_INFINITY,release:null!==(o=n.release)&&void 0!==o?o:Number.POSITIVE_INFINITY,isGif:b,isFullScreen:d,overflow:v,intersection:p,originalOpacity:g,zIndex:null!==(i=n.zIndex)&&void 0!==i?i:0,backbuffer:R,autoCrop:k};Be(this,ne,"m",Ie).call(this,F,h,A),Be(this,de,"f").push(F),Be(this,de,"f").sort(((e,t)=>e.zIndex-t.zIndex))}))}removeElement(e){const t=Be(this,de,"f").findIndex((t=>t.element===e));if(-1!==t){const n=Be(this,de,"f").splice(t,1)[0];e.style.setProperty("opacity",n.originalOpacity.toString())}}updateTextElement(e){const t=Be(this,de,"f").findIndex((t=>t.element===e));return-1!==t?Be(this,ne,"m",Pe).call(this,Be(this,de,"f")[t]):Promise.resolve()}updateCanvasElement(t){const n=Be(this,de,"f").find((e=>e.element===t));if(n){const r=n.uniforms.src.value,o=new e.CanvasTexture(t);o.wrapS=r.wrapS,o.wrapT=r.wrapT,n.uniforms.src.value=o,r.dispose()}}isPlaying(){return void 0!==Be(this,ue,"f")}play(){this.isPlaying()||$e(this,ue,requestAnimationFrame(Be(this,ze,"f")),"f")}stop(){void 0!==Be(this,ue,"f")&&(cancelAnimationFrame(Be(this,ue,"f")),$e(this,ue,void 0,"f"))}render(){var e;const r=Date.now()/1e3;Be(this,ie,"f").clear(),Be(this,ne,"m",Se).call(this);const o=Be(this,pe,"f").right-Be(this,pe,"f").left,i=Be(this,pe,"f").bottom-Be(this,pe,"f").top,s=n(0,0,o,i),a=void 0!==Be(this,fe,"f");a&&(Be(this,ne,"m",De).call(this,o,i),Be(this,ce,"f")&&(Be(this,ie,"f").setRenderTarget(Be(this,ce,"f")),Be(this,ie,"f").clear(),Be(this,ie,"f").setRenderTarget(null)));for(const n of Be(this,de,"f")){const f=n.element.getBoundingClientRect(),c=Z(f),l=Be(this,ne,"m",Ie).call(this,n,c,r);if(!l.isVisible)continue;n.uniforms.time.value=r-n.startTime,n.uniforms.resolution.value.x=f.width*Be(this,he,"f"),n.uniforms.resolution.value.y=f.height*Be(this,he,"f"),n.uniforms.mouse.value.x=Be(this,xe,"f")*Be(this,he,"f"),n.uniforms.mouse.value.y=Be(this,Te,"f")*Be(this,he,"f");for(const[e,t]of Object.entries(n.uniformGenerators))n.uniforms[e].value=t();null===(e=Ge.get(n.element))||void 0===e||e.update(),("video"===n.type||n.isGif)&&(n.uniforms.src.value.needsUpdate=!0);const u=t(c,i,Be(this,ye,"f"),Be(this,be,"f")),h=t(l.rectWithOverflow,i,Be(this,ye,"f"),Be(this,be,"f"));n.backbuffer?(n.uniforms.backbuffer.value=n.backbuffer.texture,n.isFullScreen?(n.backbuffer.resize(o,i),Be(this,ne,"m",We).call(this,n,u.x,u.y),Be(this,ne,"m",Fe).call(this,n.scene,n.backbuffer.target,s,n.uniforms),n.backbuffer.swap(),Be(this,ae,"f").setUniforms(n.backbuffer.texture,Be(this,he,"f"),s),Be(this,ne,"m",Fe).call(this,Be(this,ae,"f").scene,a&&Be(this,ce,"f")||null,s,Be(this,ae,"f").uniforms)):(n.backbuffer.resize(h.w,h.h),Be(this,ne,"m",We).call(this,n,n.overflow.left,n.overflow.bottom),Be(this,ne,"m",Fe).call(this,n.scene,n.backbuffer.target,n.backbuffer.getViewport(),n.uniforms),n.backbuffer.swap(),Be(this,ae,"f").setUniforms(n.backbuffer.texture,Be(this,he,"f"),h),Be(this,ne,"m",Fe).call(this,Be(this,ae,"f").scene,a&&Be(this,ce,"f")||null,h,Be(this,ae,"f").uniforms))):(Be(this,ne,"m",We).call(this,n,u.x,u.y),Be(this,ne,"m",Fe).call(this,n.scene,a&&Be(this,ce,"f")||null,n.isFullScreen?s:h,n.uniforms))}a&&Be(this,fe,"f")&&Be(this,ce,"f")&&(Be(this,fe,"f").setUniforms(Be(this,ce,"f").texture,Be(this,he,"f"),s,r-Be(this,ve,"f"),Be(this,xe,"f"),Be(this,Te,"f")),Be(this,fe,"f").updateCustomUniforms(Be(this,le,"f")),Be(this,fe,"f").backbuffer?(Be(this,fe,"f").uniforms.backbuffer.value=Be(this,fe,"f").backbuffer.texture,Be(this,ne,"m",Fe).call(this,Be(this,fe,"f").scene,Be(this,fe,"f").backbuffer.target,s,Be(this,fe,"f").uniforms),Be(this,fe,"f").backbuffer.swap(),Be(this,ae,"f").setUniforms(Be(this,fe,"f").backbuffer.texture,Be(this,he,"f"),s),Be(this,ne,"m",Fe).call(this,Be(this,ae,"f").scene,null,s,Be(this,ae,"f").uniforms)):Be(this,ne,"m",Fe).call(this,Be(this,fe,"f").scene,null,s,Be(this,fe,"f").uniforms))}}function _e(e,t){return t.left<=e.right&&t.right>=e.left&&t.top<=e.bottom&&t.bottom>=e.top}function qe(t){return"repeat"===t?e.RepeatWrapping:"mirror"===t?e.MirroredRepeatWrapping:e.ClampToEdgeWrapping}function Ue(e,t,n){return Math.max(t,Math.min(n,e))}re=new WeakMap,oe=new WeakMap,ie=new WeakMap,se=new WeakMap,ae=new WeakMap,fe=new WeakMap,ce=new WeakMap,le=new WeakMap,ue=new WeakMap,he=new WeakMap,de=new WeakMap,ve=new WeakMap,me=new WeakMap,pe=new WeakMap,ge=new WeakMap,we=new WeakMap,ye=new WeakMap,be=new WeakMap,xe=new WeakMap,Te=new WeakMap,Ce=new WeakMap,ke=new WeakMap,Re=new WeakMap,Me=new WeakMap,ze=new WeakMap,ne=new WeakSet,Ee=function(){if(void 0===Be(this,ke,"f")){const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.position="absolute",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;document.body.removeChild(e),$e(this,ke,t,"f")}return Be(this,ke,"f")},Se=function(){var e,t;if("undefined"==typeof window)return;const n=Be(this,oe,"f").parentElement,r=n.parentElement,o=null!==(t=null===(e=n.ownerDocument.defaultView)||void 0===e?void 0:e.window)&&void 0!==t?t:window,i=r.scrollHeight>r.clientHeight?Be(this,ne,"m",Ee).call(this):0,s=r.scrollWidth>r.clientWidth?Be(this,ne,"m",Ee).call(this):0,a=o.innerWidth-i,f=o.innerHeight-s,c=window.scrollX,l=window.scrollY;let u,h;if(Be(this,re,"f").fixedCanvas)h=0,u=0;else{const e=n.scrollWidth-(c+a),t=n.scrollHeight-(l+f);u=Ue(a*Be(this,re,"f").scrollPadding[0],0,e),h=Ue(f*Be(this,re,"f").scrollPadding[1],0,t)}const d=a+2*u,v=f+2*h;d===Be(this,we,"f")[0]&&v===Be(this,we,"f")[1]||(Be(this,oe,"f").width=d,Be(this,oe,"f").height=v,Be(this,ie,"f").setSize(d,v),Be(this,ie,"f").setPixelRatio(Be(this,he,"f")),$e(this,pe,Q({top:-h,left:-u,right:d,bottom:v}),"f"),$e(this,ge,Q({top:0,left:0,right:a,bottom:f}),"f"),$e(this,we,[d,v],"f"),$e(this,ye,u,"f"),$e(this,be,h,"f")),Be(this,re,"f").fixedCanvas||Be(this,oe,"f").style.setProperty("transform",`translate(${c-u}px, ${l-h}px)`)},Pe=function(t){return Oe(this,void 0,void 0,(function*(){if(!Be(this,Ce,"f").get(t.element)){Be(this,Ce,"f").set(t.element,!0);try{const n=t.uniforms.src.value,r=n.image,o=yield C(t.element,t.originalOpacity,r);if(0===o.width||0===o.width)throw"omg";const i=new e.CanvasTexture(o);i.wrapS=n.wrapS,i.wrapT=n.wrapT,t.uniforms.src.value=i,n.dispose()}catch(e){console.error(e)}Be(this,Ce,"f").set(t.element,!1)}}))},Ie=function(e,t,n){const r=ee(t,e.overflow),o=e.isFullScreen||_e(Be(this,ge,"f"),r),i=ee(Be(this,ge,"f"),e.intersection.rootMargin),s=function(e,t){const n=te(t.left,e.left,e.right),r=(te(t.right,e.left,e.right)-n)/(t.right-t.left),o=te(t.top,e.top,e.bottom);return r*((te(t.bottom,e.top,e.bottom)-o)/(t.bottom-t.top))}(i,t),a=e.isFullScreen||function(e,t,n,r){return 0===r?_e(e,t):n>=r}(i,t,s,e.intersection.threshold);!e.isInLogicalViewport&&a&&(e.enterTime=n,e.leaveTime=Number.POSITIVE_INFINITY),e.isInLogicalViewport&&!a&&(e.leaveTime=n),e.isInViewport=o,e.isInLogicalViewport=a;const f=o&&n-e.leaveTime<=e.release;return f&&(e.uniforms.intersection.value=s,e.uniforms.enterTime.value=n-e.enterTime,e.uniforms.leaveTime.value=n-e.leaveTime),{isVisible:f,intersection:s,rectWithOverflow:r}},Le=function(e){return e in m?m[e]:e},Ae=function(e,t){if(e)return e;if(t.includes("out vec4"))return"300 es";if(t.includes("gl_FragColor"))return"100";throw`VFX-JS error: Cannot detect GLSL version of the shader.\n\nOriginal shader:\n${t}`},Fe=function(e,t,n,r){Be(this,ie,"f").setRenderTarget(t),null!==t&&t!==Be(this,ce,"f")&&Be(this,ie,"f").clear(),Be(this,ie,"f").setViewport(n.x,n.y,n.w,n.h),r.viewport&&r.viewport.value.set(n.x*Be(this,he,"f"),n.y*Be(this,he,"f"),n.w*Be(this,he,"f"),n.h*Be(this,he,"f"));try{Be(this,ie,"f").render(e,Be(this,se,"f"))}catch(e){console.error(e)}},We=function(e,t,n){e.uniforms.offset.value.x=t*Be(this,he,"f"),e.uniforms.offset.value.y=n*Be(this,he,"f")},De=function(t,n){const r=t*Be(this,he,"f"),o=n*Be(this,he,"f");Be(this,ce,"f")&&Be(this,ce,"f").width===r&&Be(this,ce,"f").height===o||(Be(this,ce,"f")&&Be(this,ce,"f").dispose(),$e(this,ce,new e.WebGLRenderTarget(r,o,{minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat}),"f")),Be(this,fe,"f")&&(Be(this,fe,"f").uniforms.backbuffer&&!Be(this,fe,"f").backbuffer?Be(this,fe,"f").initializeBackbuffer(t,n,Be(this,he,"f")):Be(this,fe,"f").backbuffer&&Be(this,fe,"f").resizeBackbuffer(t,n))};var Ne,je,He,Ke,Xe,Ye,Je,Qe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{f(r.next(e))}catch(e){i(e)}}function a(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}f((r=r.apply(e,t||[])).next())}))},Ze=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},et=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class tt{constructor(e={}){Ne.add(this),je.set(this,void 0),He.set(this,void 0),function(){if("undefined"==typeof window)throw"Cannot find 'window'. VFX-JS only runs on the browser.";if("undefined"==typeof document)throw"Cannot find 'document'. VFX-JS only runs on the browser."}();const t=function(e){var t,n,r,o,i;const s="undefined"!=typeof window?window.devicePixelRatio:1;let a;return a=void 0===e.scrollPadding?[.1,.1]:!1===e.scrollPadding?[0,0]:Array.isArray(e.scrollPadding)?[null!==(t=e.scrollPadding[0])&&void 0!==t?t:.1,null!==(n=e.scrollPadding[1])&&void 0!==n?n:.1]:[e.scrollPadding,e.scrollPadding],{pixelRatio:null!==(r=e.pixelRatio)&&void 0!==r?r:s,zIndex:null!==(o=e.zIndex)&&void 0!==o?o:void 0,autoplay:null===(i=e.autoplay)||void 0===i||i,fixedCanvas:!1===e.scrollPadding,scrollPadding:a,postEffect:e.postEffect}}(e),n=document.createElement("canvas"),r={position:t.fixedCanvas?"fixed":"absolute",top:0,left:0,width:"100vw",height:"100vh","z-index":9999,"pointer-events":"none"};for(const[e,t]of Object.entries(r))n.style.setProperty(e,t.toString());void 0!==t.zIndex&&n.style.setProperty("z-index",t.zIndex.toString()),document.body.appendChild(n),Ze(this,He,n,"f"),Ze(this,je,new Ve(t,n),"f"),t.autoplay&&et(this,je,"f").play()}add(e,t){return Qe(this,void 0,void 0,(function*(){e instanceof HTMLImageElement?yield et(this,Ne,"m",Ke).call(this,e,t):e instanceof HTMLVideoElement?yield et(this,Ne,"m",Xe).call(this,e,t):e instanceof HTMLCanvasElement?yield et(this,Ne,"m",Ye).call(this,e,t):yield et(this,Ne,"m",Je).call(this,e,t)}))}remove(e){et(this,je,"f").removeElement(e)}update(e){return Qe(this,void 0,void 0,(function*(){return e instanceof HTMLCanvasElement?void et(this,je,"f").updateCanvasElement(e):et(this,je,"f").updateTextElement(e)}))}play(){et(this,je,"f").play()}stop(){et(this,je,"f").stop()}render(){et(this,je,"f").render()}destroy(){et(this,je,"f").destroy(),et(this,He,"f").remove()}}je=new WeakMap,He=new WeakMap,Ne=new WeakSet,Ke=function(e,t){return e.complete?et(this,je,"f").addElement(e,t):new Promise((n=>{e.addEventListener("load",(()=>{et(this,je,"f").addElement(e,t),n()}),{once:!0})}))},Xe=function(e,t){return e.readyState>=3?et(this,je,"f").addElement(e,t):new Promise((n=>{e.addEventListener("canplay",(()=>{et(this,je,"f").addElement(e,t),n()}),{once:!0})}))},Ye=function(e,t){return et(this,je,"f").addElement(e,t)},Je=function(e,t){return et(this,je,"f").addElement(e,t)};export{h as COPY_FRAGMENT_SHADER,l as DEFAULT_VERTEX_SHADER,u as DEFAULT_VERTEX_SHADER_100,tt as VFX,m as shaders};export default null;
//# sourceMappingURL=/sm/2b3c2be071906a2ddcde61663421ea3c95d34223b1f5b5394b4bba36da267dd3.map